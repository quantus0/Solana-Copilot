<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solana Copilot</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.91.8/dist/index.iife.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-100">
    <div id="root" class="min-h-screen"></div>

    <script type="text/babel">
      const { useState } = React;

      const PROGRAM_ID = "Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS";

      const WalletConnector = ({ setWallet }) => {
        const [address, setAddress] = useState(null);

        const connectWallet = async () => {
          if (window.solana) {
            try {
              const { publicKey } = await window.solana.connect();
              setAddress(publicKey.toString());
              setWallet(publicKey.toString());
            } catch (error) {
              console.error("Wallet connection failed", error);
              alert("Failed to connect wallet");
            }
          } else {
            alert("Please install a Solana wallet (e.g., Phantom)");
          }
        };

        return (
          <div className="p-4">
            {address ? (
              <p className="text-green-600">Connected: {address.slice(0, 8)}...</p>
            ) : (
              <button
                onClick={connectWallet}
                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
              >
                Connect Wallet
              </button>
            )}
          </div>
        );
      };

      const AgentCreator = ({ wallet, addAgent }) => {
        const [goal, setGoal] = useState("");

        const createAgent = () => {
          if (!wallet) {
            alert("Please connect your wallet first");
            return;
          }

          const newAgent = {
            id: Date.now(),
            goal,
            status: "Active",
            txCount: 0,
            gasSaved: 0,
          };
          addAgent(newAgent);
          setGoal("");
          alert("Agent created successfully!");
        };

        return (
          <div className="p-4 bg-white rounded shadow">
            <h2 className="text-xl font-bold mb-4">Create Agent</h2>
            <input
              type="text"
              value={goal}
              onChange={(e) => setGoal(e.target.value)}
              placeholder="Enter agent goal (e.g., Buy NFTs under 2 SOL)"
              className="w-full p-2 border rounded mb-4"
            />
            <button
              onClick={createAgent}
              className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
            >
              Create Agent
            </button>
          </div>
        );
      };

      const TxSimulator = () => {
        const simulateTx = () => {
          const mockResult = {
            success: true,
            gasEstimate: "0.001 SOL",
            details: "Simulated token transfer",
          };
          alert(`Simulation Result: ${JSON.stringify(mockResult, null, 2)}`);
        };

        return (
          <div className="p-4 bg-white rounded shadow">
            <h2 className="text-xl font-bold mb-4">Transaction Simulator</h2>
            <button
              onClick={simulateTx}
              className="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600"
            >
              Simulate Transaction
            </button>
          </div>
        );
      };

      const GasOptimizer = () => {
        const optimizeGas = () => {
          const mockResult = {
            originalGas: "0.002 SOL",
            optimizedGas: "0.0015 SOL",
          };
          alert(`Gas Optimization: ${JSON.stringify(mockResult, null, 2)}`);
        };

        return (
          <div className="p-4 bg-white rounded shadow">
            <h2 className="text-xl font-bold mb-4">Gas Optimizer</h2>
            <button
              onClick={optimizeGas}
              className="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600"
            >
              Optimize Gas
            </button>
          </div>
        );
      };

      const Analytics = () => {
        const mockData = {
          agentsCreated: 5,
          totalTx: 20,
          gasSaved: "0.05 SOL",
        };

        return (
          <div className="p-4 bg-white rounded shadow">
            <h2 className="text-xl font-bold mb-4">Analytics</h2>
            <p>Agents Created: {mockData.agentsCreated}</p>
            <p>Total Transactions: {mockData.totalTx}</p>
            <p>Gas Saved: {mockData.gasSaved}</p>
          </div>
        );
      };

      const AgentDetails = ({ agent }) => {
        if (!agent) return null;

        return (
          <div className="p-4 bg-white rounded shadow">
            <h2 className="text-xl font-bold mb-4">Agent Details</h2>
            <p>ID: {agent.id}</p>
            <p>Goal: {agent.goal}</p>
            <p>Status: {agent.status}</p>
            <p>Transactions: {agent.txCount}</p>
            <p>Gas Saved: {agent.gasSaved} SOL</p>
          </div>
        );
      };

      const App = () => {
        const [wallet, setWallet] = useState(null);
        const [agents, setAgents] = useState([]);
        const [selectedAgent, setSelectedAgent] = useState(null);

        const addAgent = (agent) => setAgents([...agents, agent]);
        const selectAgent = (id) => setSelectedAgent(agents.find((a) => a.id === id));

        return (
          <div className="container mx-auto p-4">
            <h1 className="text-3xl font-bold text-center mb-8">Solana Copilot</h1>

            <WalletConnector setWallet={setWallet} />

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <AgentCreator wallet={wallet} addAgent={addAgent} />
              <TxSimulator />
              <GasOptimizer />
              <Analytics />
            </div>

            <div className="mt-8">
              <h2 className="text-2xl font-bold mb-4">Your Agents</h2>
              <div className="grid grid-cols-1 gap-4">
                {agents.map((agent) => (
                  <div
                    key={agent.id}
                    onClick={() => selectAgent(agent.id)}
                    className="p-4 bg-gray-200 rounded cursor-pointer hover:bg-gray-300"
                  >
                    <p>Goal: {agent.goal}</p>
                    <p>Status: {agent.status}</p>
                  </div>
                ))}
              </div>
              <AgentDetails agent={selectedAgent} />
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
